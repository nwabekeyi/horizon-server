import{r as i,l as M,o as B,j as e,B as u,P as O,S as g,I as E,p as C,E as K,D as P}from"./index-C-veA1Rv.js";import{u as L}from"./useApi-hqwvaQFr.js";import{C as N}from"./modal-Cq9y4NFa.js";import{F as U}from"./index-ClSCEk6E.js";import{B as b}from"./Button-BUtGUVw6.js";import{L as w}from"./Link-Dkvr2300.js";import{T as l}from"./Typography-DNw0gmHs.js";import{D as G}from"./Divider-BdkZDBHz.js";import{T as y}from"./TextField-CH6IKT9T.js";import{I as H}from"./InputAdornment-BVYIlHg7.js";import{I as $}from"./Grow-DEkHVcDO.js";import{F as J,C as Q}from"./FormControlLabel-X_ttzFaA.js";import"./useTheme-CSbpYfTu.js";import"./ButtonBase-DHTngUyU.js";import"./useIsFocusVisible-SVz0b4Hl.js";import"./dividerClasses-D34xdAHQ.js";const V=c=>"success"in c&&"message"in c,ue=()=>{const[c,p]=i.useState(!1),[r,j]=i.useState({email:"",password:""}),[f,A]=i.useState(!1),[s,v]=i.useState(!1),[m,h]=i.useState(null),[k,S]=i.useState(!1),D=M(),F=B(),d=i.useRef(null),{error:I,callApi:R}=L(),x=t=>{j({...r,[t.target.name]:t.target.value}),h(null)},T=async t=>{var a;if(t.preventDefault(),p(!0),s){const o={email:r.email};try{await R({url:K.FORGETPASSWORD,method:"POST",body:o}),S(!0)}catch(n){p(!1),console.error("Forgot Password API Error:",n),h("Failed to request password reset. Please try again.")}}else{const o=await D(P({email:r.email,password:r.password}));if(P.fulfilled.match(o)){const n=o.payload;V(n)&&n.success&&n.message==="2FA required"&&((a=n.twoFA)!=null&&a.enabled)&&n.twoFA.userId?(sessionStorage.setItem("twoFAUserId",n.twoFA.userId),F("/authentication/2FAverification")):F(C.dashboard)}else h(o.payload);p(!1)}},q=t=>{if(t.key==="Enter"&&!s)if(t.preventDefault(),d.current)d.current.requestSubmit();else{const a=t.currentTarget.form;if(a){const o=new Event("submit",{bubbles:!0,cancelable:!0});a.dispatchEvent(o)}}},W=t=>{if(t.key==="Enter"&&s)if(t.preventDefault(),d.current)d.current.requestSubmit();else{const a=t.currentTarget.form;if(a){const o=new Event("submit",{bubbles:!0,cancelable:!0});a.dispatchEvent(o)}}},z=()=>{S(!1),s&&(v(!1),j({email:"",password:""}))};return c?e.jsx(u,{sx:{display:"grid",placeContent:"center",width:"100%"},children:e.jsx(O,{})}):e.jsxs(g,{mx:"auto",width:410,height:"auto",minHeight:800,direction:"column",alignItems:"center",justifyContent:"space-between",children:[e.jsx(u,{width:1,children:e.jsx(b,{variant:"text",component:w,href:"https://247activetrading.vercel.app/",sx:{ml:-1.75,pl:1,pr:2},startIcon:e.jsx(E,{icon:"ic:round-keyboard-arrow-left",sx:t=>({fontSize:`${t.typography.h3.fontSize} !important`})}),children:"Back to home page"})}),e.jsxs(u,{width:1,children:[e.jsx(l,{color:"info.darker",variant:"h3",children:s?"Forgot Password":"Sign In"}),e.jsx(l,{mt:1.5,variant:"body2",color:"text.disabled",children:s?"Enter your email to reset your password.":"Enter your email and password to sign in!"}),e.jsx(G,{sx:{my:3},children:"or"}),e.jsxs(u,{component:"form",onSubmit:T,ref:d,children:[s?e.jsxs(g,{direction:"column",spacing:3,children:[e.jsx(y,{id:"forgot-email",name:"email",label:"Email",type:"email",value:r.email,onChange:x,onKeyDown:W,variant:"filled",placeholder:"mail@example.com",autoComplete:"email",fullWidth:!0,required:!0,autoFocus:!0,sx:{mb:3,"& .MuiFilledInput-root":{border:"1px solid grey",bgcolor:"grey.100"}}}),m&&e.jsx(l,{color:"error",variant:"body2",children:m}),e.jsx(b,{type:"submit",variant:"contained",size:"large",fullWidth:!0,children:"Reset Password"})]}):e.jsxs(e.Fragment,{children:[e.jsx(y,{id:"email",name:"email",type:"email",label:"Email",value:r.email,onChange:x,variant:"filled",placeholder:"mail@example.com",autoComplete:"email",sx:{mt:3,"& .MuiFilledInput-root":{border:"1px solid grey",bgcolor:"grey.100"}},fullWidth:!0,autoFocus:!0,required:!0}),e.jsx(y,{id:"password",name:"password",label:"Password",type:f?"text":"password",value:r.password,onChange:x,onKeyDown:q,variant:"filled",placeholder:"Min. 8 characters",autoComplete:"current-password",sx:{mt:6,"& .MuiFilledInput-root":{border:"1px solid grey",bgcolor:"grey.100"}},fullWidth:!0,required:!0,InputProps:{endAdornment:e.jsx(H,{position:"end",sx:{opacity:r.password?1:0,pointerEvents:r.password?"auto":"none"},children:e.jsx($,{"aria-label":"toggle password visibility",onClick:()=>A(!f),sx:{border:"none",bgcolor:"transparent !important"},edge:"end",children:e.jsx(E,{icon:f?"ic:outline-visibility":"ic:outline-visibility-off",color:"neutral.main"})})})}}),m&&e.jsx(l,{color:"error",variant:"body2",mt:2,children:m}),e.jsx(b,{type:"submit",variant:"contained",size:"large",sx:{mt:3},fullWidth:!0,children:"Sign In"})]}),I&&e.jsx(l,{color:"error",variant:"body2",sx:{mt:2},children:I.message})]}),e.jsxs(g,{mt:1.5,alignItems:"center",justifyContent:"space-between",children:[e.jsx(J,{control:e.jsx(Q,{id:"checkbox",name:"checkbox",size:"medium",color:"primary"}),label:"Keep me logged in",sx:{ml:-.75}}),e.jsx(w,{component:"button",onClick:()=>v(!0),fontSize:"body2.fontSize",fontWeight:600,color:"info.darker",children:"Forgot password?"})]}),!s&&e.jsxs(l,{mt:3,variant:"body2",textAlign:{xs:"center",md:"left"},letterSpacing:.25,children:["Not registered yet?"," ",e.jsx(w,{href:C.signup,color:"info.darker",fontWeight:600,children:"Create an Account"})]}),e.jsx(N,{open:k,title:"Password Reset Requested",onCancel:z,noConfirm:!0,children:e.jsx(l,{variant:"body1",children:"A password reset link has been sent to your email. Please check your inbox."})})]}),e.jsx(U,{})]})};export{ue as default};

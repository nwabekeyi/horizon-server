import{r as c,i as B,o as E,j as e,P as U,S as D,B as l,I as d,F as T}from"./index-C-veA1Rv.js";import{u as L}from"./useApi-hqwvaQFr.js";import{C as M,a as R}from"./modal-Cq9y4NFa.js";import{F as W}from"./index-ClSCEk6E.js";import{B as m}from"./Button-BUtGUVw6.js";import{L as u}from"./Link-Dkvr2300.js";import{T as a}from"./Typography-DNw0gmHs.js";import{T as g}from"./TextField-CH6IKT9T.js";import{I as y}from"./InputAdornment-BVYIlHg7.js";import{I as j}from"./Grow-DEkHVcDO.js";import"./useTheme-CSbpYfTu.js";import"./ButtonBase-DHTngUyU.js";import"./useIsFocusVisible-SVz0b4Hl.js";const _=()=>{const[t,w]=c.useState({newSecret:"",confirmSecret:""}),[r,p]=c.useState(!1),[h,o]=c.useState(null),[v,f]=c.useState(!1),A=B(),F=E(),{error:i,loading:C,callApi:I}=L(),x=new URLSearchParams(A.search).get("token")||"",S=n=>{w({...t,[n.target.name]:n.target.value}),o(null)},k=async n=>{if(n.preventDefault(),t.newSecret!==t.confirmSecret){o("Secrets do not match");return}if(t.newSecret.length<6){o("2FA secret must be at least 6 characters");return}if(!x){o("Invalid or missing token");return}const P={newSecret:t.newSecret};try{const s=await I({url:`${T}/confirm-update?token=${x}`,method:"PUT",body:P});s.success?f(!0):o(s.message||"Failed to update 2FA secret")}catch(s){console.error("API Error:",s),o((i==null?void 0:i.message)||"Failed to update 2FA secret. Please try again.")}},b=()=>{f(!1),F("/dashboard")};return C?e.jsx(U,{}):e.jsxs(D,{mx:"auto",width:410,height:"auto",minHeight:800,direction:"column",alignItems:"center",justifyContent:"space-between",children:[e.jsx(l,{width:1,children:e.jsx(m,{variant:"text",component:u,href:"https://247activetrading.vercel.app",sx:{ml:-1.75,pl:1,pr:2},startIcon:e.jsx(d,{icon:"ic:round-keyboard-arrow-left",sx:n=>({fontSize:`${n.typography.h3.fontSize} !important`})}),children:"Back to home"})}),e.jsxs(l,{width:1,children:[e.jsx(a,{variant:"h3",children:"Update 2FA Secret"}),e.jsx(a,{mt:1.5,variant:"body2",color:"text.disabled",children:"Enter your new 2FA secret to update your two-factor authentication."}),e.jsxs(l,{component:"form",onSubmit:k,children:[e.jsx(g,{id:"newSecret",name:"newSecret",label:"New 2FA Secret",type:r?"text":"password",value:t.newSecret,onChange:S,variant:"filled",placeholder:"Min. 6 characters",autoComplete:"new-password",sx:{mt:3},fullWidth:!0,required:!0,InputProps:{endAdornment:e.jsx(y,{position:"end",sx:{opacity:t.newSecret?1:0,pointerEvents:t.newSecret?"auto":"none"},children:e.jsx(j,{"aria-label":"toggle secret visibility",onClick:()=>p(!r),sx:{border:"none",bgcolor:"transparent !important"},edge:"end",children:e.jsx(d,{icon:r?"ic:outline-visibility":"ic:outline-visibility-off",color:"neutral.main"})})})}}),e.jsx(g,{id:"confirmSecret",name:"confirmSecret",label:"Confirm 2FA Secret",type:r?"text":"password",value:t.confirmSecret,onChange:S,variant:"filled",placeholder:"Confirm your new 2FA secret",sx:{mt:6},fullWidth:!0,required:!0,InputProps:{endAdornment:e.jsx(y,{position:"end",sx:{opacity:t.confirmSecret?1:0,pointerEvents:t.confirmSecret?"auto":"none"},children:e.jsx(j,{"aria-label":"toggle secret visibility",onClick:()=>p(!r),sx:{border:"none",bgcolor:"transparent !important"},edge:"end",children:e.jsx(d,{icon:r?"ic:outline-visibility":"ic:outline-visibility-off",color:"neutral.main"})})})}}),h&&e.jsx(a,{color:"error",variant:"body2",mt:2,children:h}),i&&e.jsx(a,{color:"error",variant:"body2",mt:2,children:i.message}),e.jsx(m,{type:"submit",variant:"contained",size:"large",sx:{mt:3},fullWidth:!0,children:"Update 2FA Secret"})]}),e.jsxs(a,{mt:3,variant:"body2",textAlign:{xs:"center",md:"left"},letterSpacing:.25,children:["Return to"," ",e.jsx(u,{href:"/dashboard",color:"primary.main",fontWeight:600,children:"Dashboard"})]}),e.jsx(M,{open:v,title:"2FA Secret Updated",onCancel:b,noConfirm:!0,children:e.jsxs(R,{children:[e.jsx(a,{variant:"body1",children:"Your 2FA secret has been successfully updated! You will be redirected to your dashboard."}),e.jsx(m,{component:u,href:"/dashboard",variant:"contained",color:"primary",sx:{mt:2},onClick:b,children:"Go to Dashboard"})]})})]}),e.jsx(W,{})]})};export{_ as default};

import{r as a,j as e,B as p,P as H,S as h,I as T,p as k,E as I}from"./index-C-veA1Rv.js";import{u as J}from"./useApi-hqwvaQFr.js";import{C as _}from"./modal-Cq9y4NFa.js";import{F as Q}from"./index-ClSCEk6E.js";import{B as g}from"./Button-BUtGUVw6.js";import{L as f}from"./Link-Dkvr2300.js";import{T as n}from"./Typography-DNw0gmHs.js";import{D as V}from"./Divider-BdkZDBHz.js";import{T as N}from"./TextField-CH6IKT9T.js";import{I as X}from"./InputAdornment-BVYIlHg7.js";import{I as Z}from"./Grow-DEkHVcDO.js";import"./useTheme-CSbpYfTu.js";import"./ButtonBase-DHTngUyU.js";import"./useIsFocusVisible-SVz0b4Hl.js";import"./dividerClasses-D34xdAHQ.js";const ge=()=>{const[s,O]=a.useState({firstName:"",lastName:"",email:"",password:"",confirmPassword:""}),[y,W]=a.useState(!1),[x,M]=a.useState(!1),[l,B]=a.useState(!1),[c,F]=a.useState(!1),[w,D]=a.useState(["","","",""]),[d,m]=a.useState(null),[L,b]=a.useState(!1),[j,P]=a.useState(null),{error:E,loading:q,callApi:v}=J(),S=[a.useRef(null),a.useRef(null),a.useRef(null),a.useRef(null)],z=[{id:"firstName",name:"firstName",label:"First Name",type:"text",placeholder:"Your First Name",autoComplete:"given-name"},{id:"lastName",name:"lastName",label:"Last Name",type:"text",placeholder:"Your Last Name",autoComplete:"family-name"},{id:"email",name:"email",label:"Email",type:"email",placeholder:"mail@example.com",autoComplete:"email"},{id:"password",name:"password",label:"Password",type:y?"text":"password",placeholder:"Min. 8 characters",autoComplete:"new-password",showToggle:!0},{id:"confirmPassword",name:"confirmPassword",label:"Confirm Password",type:x?"text":"password",placeholder:"Confirm your password",autoComplete:"new-password",showToggle:!0}],R=o=>{const{name:t,value:r}=o.target;O({...s,[t]:r}),m(null)},U=async(o,t)=>{var A;const r=o.target.value;if(/^\d$/.test(r)||r===""){const u=[...w];if(u[t]=r,D(u),m(null),r&&t<3&&((A=S[t+1].current)==null||A.focus()),t===3&&u.every(C=>C.length===1)){const C=u.join(""),K={firstName:s.firstName,lastName:s.lastName,email:s.email,password:s.password,pin:C,role:"user"};try{const i=await v({url:I.USERS,method:"POST",body:K});"success"in i&&i.success?(P("signup"),b(!0)):m(i.message||"Failed to complete registration.")}catch(i){console.error("API Error:",i),m(i instanceof Error?i.message:"An error occurred during registration.")}}}},Y=(o,t)=>{var r;o.key==="Backspace"&&w[t]===""&&t>0&&((r=S[t-1].current)==null||r.focus())},G=async o=>{if(o.preventDefault(),!l)if(c){const t={email:s.email};try{await v({url:I.FORGETPASSWORD,method:"POST",body:t}),P("forgotPassword"),b(!0)}catch(r){console.error("API Error:",r)}}else{if(s.password!==s.confirmPassword){m("Passwords do not match");return}m(null);const t={firstName:s.firstName,email:s.email};try{await v({url:I.REGISTRATION_PIN,method:"POST",body:t}),B(!0)}catch(r){console.error("API Error:",r)}}},$=()=>{b(!1),P(null),c&&F(!1)};return q?e.jsx(p,{sx:{width:"100%",display:"flex",justifyContent:"center",alignItems:"center"},children:e.jsx(H,{})}):e.jsxs(h,{mx:"auto",width:410,height:"auto",minHeight:800,direction:"column",alignItems:"center",justifyContent:"space-between",children:[e.jsx(p,{width:1,children:e.jsx(g,{variant:"text",component:f,href:"https://247activetrading.vercel.app",sx:{ml:-1.75,pl:1,pr:2},startIcon:e.jsx(T,{icon:"ic:round-keyboard-arrow-left",sx:o=>({fontSize:`${o.typography.h3.fontSize} !important`})}),children:"Back to home page"})}),e.jsxs(p,{width:1,children:[e.jsx(n,{variant:"h3",children:c?"Forgot Password":l?"You are almost there":"Sign Up"}),e.jsx(n,{mt:1.5,variant:"body2",color:"text.disabled",children:c?"Enter your email to reset your password.":l?"Complete the registration and get access to your account":"Join us and start your journey today!"}),e.jsx(V,{sx:{my:3},children:l?"":"or"}),e.jsxs(p,{component:"form",onSubmit:G,children:[l?e.jsxs(e.Fragment,{children:[e.jsx(n,{variant:"body2",color:"text.secondary",mb:2,sx:{fontWeight:"bold"},children:"Please check your email inbox or spam folder for the PIN we sent you."}),e.jsx(h,{direction:"row",spacing:2,justifyContent:"center",alignItems:"center",children:w.map((o,t)=>e.jsx(N,{value:o,onChange:r=>U(r,t),onKeyDown:r=>Y(r,t),inputProps:{maxLength:1,style:{textAlign:"center",fontSize:"24px"}},variant:"filled",inputRef:S[t],sx:{width:50,height:60,mb:5,"& .MuiFilledInput-root":{border:"1px solid grey",bgcolor:"grey.100"}},required:!0},t))})]}):c?e.jsxs(h,{direction:"column",spacing:3,children:[e.jsx(N,{id:"forgot-email",name:"email",label:"Email",type:"email",value:s.email,onChange:R,variant:"filled",placeholder:"mail@example.com",autoComplete:"email",fullWidth:!0,required:!0,autoFocus:!0,sx:{mb:3,"& .MuiFilledInput-root":{border:"1px solid grey",bgcolor:"grey.100"}}}),d&&e.jsx(n,{color:"error",variant:"body2",children:d}),e.jsx(g,{type:"submit",variant:"contained",size:"large",fullWidth:!0,children:"Reset Password"})]}):e.jsxs(h,{direction:"column",spacing:3,children:[z.map((o,t)=>e.jsx(N,{id:o.id,name:o.name,label:o.label,type:o.type,value:s[o.name],onChange:R,variant:"filled",placeholder:o.placeholder,autoComplete:o.autoComplete,fullWidth:!0,required:!0,autoFocus:t===0,sx:{mb:3,"& .MuiFilledInput-root":{border:"1px solid grey",bgcolor:"grey.100"}},InputProps:o.showToggle?{endAdornment:e.jsx(X,{position:"end",sx:{opacity:s[o.name]?1:0,pointerEvents:s[o.name]?"auto":"none"},children:e.jsx(Z,{"aria-label":`toggle ${o.name} visibility`,onClick:()=>o.name==="password"?W(!y):M(!x),sx:{border:"none",bgcolor:"transparent !important"},edge:"end",children:e.jsx(T,{icon:o.name==="password"&&y||o.name==="confirmPassword"&&x?"ic:outline-visibility":"ic:outline-visibility-off",color:"neutral.main"})})})}:void 0},o.id)),d&&e.jsx(n,{color:"error",variant:"body2",children:d}),e.jsx(g,{type:"submit",variant:"contained",size:"large",fullWidth:!0,children:"Sign Up"})]}),E&&e.jsx(n,{color:"error",variant:"body2",sx:{mt:2},children:E.message})]}),!c&&!l&&e.jsxs(n,{mt:3,variant:"body2",textAlign:{xs:"center",md:"left"},letterSpacing:.25,children:["Already have an account?"," ",e.jsx(f,{href:k.signin,color:"primary.main",fontWeight:600,children:"Let's Sign in"})," | ",e.jsx(f,{component:"button",onClick:()=>F(!0),color:"primary.main",fontWeight:600,children:"Forgot Password?"})]}),e.jsxs(_,{open:L,title:j==="forgotPassword"?"Password Reset Requested":"Registration has been completed",onCancel:$,noConfirm:!0,children:[e.jsx(n,{variant:"body1",children:j==="forgotPassword"?"A password reset link has been sent to your email. Please check your inbox.":"Your account has been created successfully! Would you like to log in now?"}),j==="signup"&&e.jsx(g,{component:f,href:k.signin,variant:"contained",color:"primary",sx:{mt:2},children:"Go to Login"})]})]}),e.jsx(Q,{})]})};export{ge as default};

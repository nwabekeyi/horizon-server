import{r as s,o as F,l as k,j as e,P as E,S as P,B as c,I as x,F as T,G as B}from"./index-C-veA1Rv.js";import{u as V}from"./useApi-hqwvaQFr.js";import{C as D,a as U}from"./modal-Cq9y4NFa.js";import{F as z}from"./index-ClSCEk6E.js";import{B as l}from"./Button-BUtGUVw6.js";import{L as g}from"./Link-Dkvr2300.js";import{T as r}from"./Typography-DNw0gmHs.js";import{T as L}from"./TextField-CH6IKT9T.js";import{I as M}from"./InputAdornment-BVYIlHg7.js";import{I as O}from"./Grow-DEkHVcDO.js";import"./useTheme-CSbpYfTu.js";import"./ButtonBase-DHTngUyU.js";import"./useIsFocusVisible-SVz0b4Hl.js";const _=()=>{const[o,y]=s.useState({secret:""}),[a,v]=s.useState(!1),[d,n]=s.useState(null),[j,u]=s.useState(!1),m=F(),b=k(),{error:h,loading:I,callApi:S}=V(),w=i=>{y({...o,secret:i.target.value}),n(null)},C=async i=>{i.preventDefault();const f=sessionStorage.getItem("twoFAUserId");if(!f){n("User session not found. Please log in again."),m("/authentication/sign-in");return}if(!o.secret.trim()){n("Please enter the verification code");return}const A={userId:f,secret:o.secret};try{const t=await S({url:`${T}/verify`,method:"POST",body:A});t.success?(t.token&&localStorage.setItem("token",t.token),b(B({user:t.user,token:t.token})),sessionStorage.removeItem("twoFAUserId"),u(!0)):n(t.message||"Invalid verification code")}catch(t){console.error("API Error:",t),n("Failed to verify code. Please try again.")}},p=()=>{u(!1),m("/dashboard")};return I?e.jsx(E,{}):e.jsxs(P,{mx:"auto",width:410,height:"auto",minHeight:800,direction:"column",alignItems:"center",justifyContent:"space-between",children:[e.jsx(c,{width:1,children:e.jsx(l,{variant:"text",component:g,href:"/authentication/sign-in",sx:{ml:-1.75,pl:1,pr:2},startIcon:e.jsx(x,{icon:"ic:round-keyboard-arrow-left",sx:i=>({fontSize:`${i.typography.h3.fontSize} !important`})}),children:"Back to login"})}),e.jsxs(c,{width:1,children:[e.jsx(r,{variant:"h3",children:"Two-Factor Verification"}),e.jsx(r,{mt:1.5,variant:"body2",color:"text.disabled",children:"Enter the verification code from your authenticator app"}),e.jsxs(c,{component:"form",onSubmit:C,children:[e.jsx(L,{id:"secret",name:"secret",label:"Verification Code",type:a?"text":"password",value:o.secret,onChange:w,variant:"filled",placeholder:"Enter your code",sx:{mt:3},fullWidth:!0,required:!0,InputProps:{endAdornment:e.jsx(M,{position:"end",sx:{opacity:o.secret?1:0,pointerEvents:o.secret?"auto":"none"},children:e.jsx(O,{"aria-label":"toggle code visibility",onClick:()=>v(!a),sx:{border:"none",bgcolor:"transparent !important"},edge:"end",children:e.jsx(x,{icon:a?"ic:outline-visibility":"ic:outline-visibility-off",color:"neutral.main"})})})}}),d&&e.jsx(r,{color:"error",variant:"body2",mt:2,children:d}),h&&e.jsx(r,{color:"error",variant:"body2",mt:2,children:h.message}),e.jsx(l,{type:"submit",variant:"contained",size:"large",sx:{mt:3},fullWidth:!0,children:"Verify Code"})]}),e.jsxs(r,{mt:3,variant:"body2",textAlign:{xs:"center",md:"left"},letterSpacing:.25,children:["Lost access to your authenticator?"," ",e.jsx(g,{href:"/authentication/recovery",color:"primary.main",fontWeight:600,children:"Recover Account"})]}),e.jsx(D,{open:j,title:"Verification Successful",onCancel:p,noConfirm:!0,children:e.jsxs(U,{children:[e.jsx(r,{variant:"body1",children:"Two-factor authentication verified successfully!"}),e.jsx(l,{variant:"contained",color:"primary",onClick:p,sx:{mt:2},children:"Continue"})]})})]}),e.jsx(z,{})]})};export{_ as default};

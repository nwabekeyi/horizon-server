import{s as b,J as Ce,H as Ae,j as e,B as i,M as X,r as u,E as Y,l as Ne,X as Se,N as _e}from"./index-C-veA1Rv.js";import{A as ye}from"./Avatar-ixKJs6sO.js";import{u as q}from"./useApi-hqwvaQFr.js";import{C as L}from"./modal-Cq9y4NFa.js";import{T as a}from"./Typography-DNw0gmHs.js";import{u as Pe,T as We,a as Re,b as Me,c as we}from"./TabPanel-B4NRPBBp.js";import{B as se}from"./Button-BUtGUVw6.js";import{F as w,I as k,S as I,T as W,b as ke}from"./TextField-CH6IKT9T.js";import{M as m}from"./KeyboardArrowRight-BWjR8Xyf.js";import{S as Ie}from"./statusBadge-hmSZ3RLa.js";import{C as Q}from"./Card-DUZ4M9b6.js";import{A as Oe}from"./Account-vuG7oa-d.js";import{F as Ue,a as ue,b as Fe}from"./index-B9-GP8Fy.js";import{I as ce}from"./Grow-DEkHVcDO.js";import{u as De}from"./useTheme-CSbpYfTu.js";import{G as ae}from"./Grid-DnwqgOY3.js";import{D as Be}from"./Divider-BdkZDBHz.js";import{u as $e}from"./useUserdetails-B_CkXpGQ.js";import"./useSlot-Db2Wk8V8.js";import"./useIsFocusVisible-SVz0b4Hl.js";import"./ButtonBase-DHTngUyU.js";import"./tslib.es6-xyAoBO8G.js";import"./dividerClasses-D34xdAHQ.js";import"./InputAdornment-BVYIlHg7.js";import"./iconBase-Bz53TZrF.js";const Ye=b(ye)(()=>({borderColor:Ce[300],backgroundColor:Ae[500]})),Le=t=>e.jsx(Ye,{...t}),ze=b(a)(({theme:t,status:s})=>({fontSize:12,fontWeight:500,padding:"4px 8px",borderRadius:"12px",color:"white",backgroundColor:s==="completed"?t.palette.success.main:s==="pending"?t.palette.warning.main:t.palette.error.main})),Ge=({selectedTransaction:t,onClose:s})=>e.jsx(L,{open:!!t,title:"Transaction Details",onCancel:s,noConfirm:!0,children:t&&e.jsxs(i,{children:[e.jsxs(a,{variant:"body2",mb:1,children:[e.jsx("strong",{children:"Company:"})," ",t.companyName]}),e.jsxs(a,{variant:"body2",mb:1,children:[e.jsx("strong",{children:"Transaction ID:"})," ",t.transactionId]}),e.jsxs(a,{variant:"body2",mb:1,children:[e.jsx("strong",{children:"Amount:"})," ",t.amount.toFixed(2)," ",t.currencyType==="crypto"&&t.cryptoCurrency?t.cryptoCurrency.toUpperCase():t.currencyType.toUpperCase()]}),e.jsxs(a,{variant:"body2",mb:1,children:[e.jsx("strong",{children:"Status:"})," ",e.jsx(ze,{status:t.status,children:t.status.charAt(0).toUpperCase()+t.status.slice(1)})]}),e.jsxs(a,{variant:"body2",mb:1,children:[e.jsx("strong",{children:"Currency:"})," ",t.currencyType==="crypto"&&t.cryptoCurrency?t.cryptoCurrency.toUpperCase():t.currencyType.toUpperCase()]}),e.jsxs(a,{variant:"body2",mb:1,children:[e.jsx("strong",{children:"Proof URL:"})," ",e.jsx("a",{href:t.proofUrl,target:"_blank",rel:"noopener noreferrer",children:"View Proof"})]}),e.jsxs(a,{variant:"body2",mb:1,children:[e.jsx("strong",{children:"Created At:"})," ",new Date(t.createdAt).toLocaleString("en-US",{dateStyle:"medium",timeStyle:"short"})]}),e.jsxs(a,{variant:"body2",mb:1,children:[e.jsx("strong",{children:"Updated At:"})," ",new Date(t.updatedAt).toLocaleString("en-US",{dateStyle:"medium",timeStyle:"short"})]})]})}),Ke=({isOpen:t,onClose:s,exchangeLoading:l,exchangeError:r,exchangeData:o,calculateTotals:y})=>e.jsxs(L,{open:t,title:"Total Investment",onCancel:s,noConfirm:!0,children:[l&&e.jsx(i,{display:"flex",justifyContent:"center",my:2,children:e.jsx(X,{size:24})}),r&&e.jsxs(a,{color:"error",variant:"body2",mb:2,children:["Error fetching exchange rates: ",r.message]}),!l&&!r&&e.jsx(i,{children:(()=>{var p,g,h;const x=y();return e.jsxs(e.Fragment,{children:[e.jsxs(a,{variant:"body2",mb:1,children:[e.jsx("strong",{children:"Total Fiat (USD):"})," $",x.fiat.toFixed(2)]}),e.jsxs(a,{variant:"body2",mb:1,children:[e.jsx("strong",{children:"Total BTC:"})," ",x.btc.toFixed(8)," (~$",(x.btc*(((p=o==null?void 0:o.bitcoin)==null?void 0:p.usd)||0)).toFixed(2),")"]}),e.jsxs(a,{variant:"body2",mb:1,children:[e.jsx("strong",{children:"Total ETH:"})," ",x.eth.toFixed(8)," (~$",(x.eth*(((g=o==null?void 0:o.ethereum)==null?void 0:g.usd)||0)).toFixed(2),")"]}),e.jsxs(a,{variant:"body2",mb:1,children:[e.jsx("strong",{children:"Total USDT:"})," ",x.usdt.toFixed(2)," (~$",(x.usdt*(((h=o==null?void 0:o.tether)==null?void 0:h.usd)||0)).toFixed(2),")"]}),e.jsxs(a,{variant:"body2",fontWeight:600,mt:2,children:[e.jsx("strong",{children:"Total in USD:"})," $",x.totalUsd.toFixed(2)]})]})})()})]}),qe=b(se)(({theme:t})=>({marginTop:t.spacing(2),textTransform:"none"})),He=b(i)(({theme:t})=>({border:`2px dashed ${t.palette.divider}`,borderRadius:t.shape.borderRadius,padding:t.spacing(2),textAlign:"center",cursor:"pointer",backgroundColor:t.palette.background.default,"&:hover":{backgroundColor:t.palette.action.hover},marginBottom:t.spacing(2)})),Je=b(i)(({theme:t})=>({border:`1px solid ${t.palette.divider}`,borderRadius:t.shape.borderRadius,padding:t.spacing(2),backgroundColor:t.palette.background.paper,marginBottom:t.spacing(2),boxShadow:t.shadows[1]})),Ve=({isOpen:t,onClose:s,message:l,isSuccess:r})=>e.jsx(L,{open:t,title:r?"Success":"Error",onCancel:s,onConfirm:s,children:e.jsx(a,{variant:"body1",color:r?"success.main":"error.main",textAlign:"center",children:l})}),Xe=({isOpen:t,onClose:s,user:l,brokerFeeLoading:r,brokerFeeError:o,brokerFeeData:y,callApi:x})=>{var ie;const[p,g]=u.useState(""),[h,A]=u.useState(""),[j,v]=u.useState(""),[T,N]=u.useState(""),[S,_]=u.useState(""),[P,n]=u.useState(""),[f,O]=u.useState(null),[C,R]=u.useState(""),[Z,ee]=u.useState(!1),[ne,H]=u.useState(""),[re,U]=u.useState(!1),[c,J]=u.useState(!1),{data:M,loading:F,error:z,callApi:E}=q();u.useEffect(()=>{t&&(l!=null&&l._id)&&E({url:`${Y.PAYMENT_ACCOUNTS}?userId=${l._id}`,method:"GET",headers:{Authorization:`Bearer ${sessionStorage.getItem("token")}`}})},[t,l==null?void 0:l._id,E]);const D=M?M.filter(d=>h==="fiat"?!!d.accountNumber:!!d.walletAddress):[];u.useEffect(()=>{v(h==="fiat"?"usd":h==="crypto"?"usdt":""),N(""),n("")},[h]),u.useEffect(()=>{D.length===1?(N(D[0]._id),n("")):N("")},[D]);const B=D.find(d=>d._id===T),{getRootProps:me,getInputProps:xe,isDragActive:be}=Pe({onFileAccepted:d=>{if(console.log("Accepted file:",{name:d.name,type:d.type,size:d.size}),d.type!=="image/png"){R("Proof must be a PNG file");return}O(d),R("")},onFileRejected:d=>{console.log("File rejected:",d),R(d)},maxCompressedSizeMB:5}),G=parseFloat(p)||0,je=((ie=y==null?void 0:y.brokerFee)==null?void 0:ie.fee)||0,le=G*je/100,ge=()=>isNaN(G)||G<=0?(_("Please enter a valid amount"),!1):l&&G>(l.accountBalance||0)?(_("Amount exceeds available balance"),!1):(_(""),!0),fe=()=>T?(n(""),!0):(n("Please select a payment account"),!1),Ee=()=>f?(R(""),!0):(R("Please upload proof of broker fee payment"),!1),ve=async()=>{if(!l||!ge()||!fe()||!Ee()||!f||!j)return;ee(!0);const d=new FormData;d.append("user",l._id),d.append("amount",G.toString()),d.append("currency",j),d.append("brokerFee",le.toString()),d.append("brokerFeeProof",f,f.name),d.append("paymentAccountId",T),d.append("remarks","");for(const[K,de]of d.entries())console.log(`${K}:`,de);try{const K=await x({url:Y.WITHDRAWALS,method:"POST",body:d,headers:{}});H(K.message),J(!0),U(!0),s()}catch(K){console.error("Withdrawal request failed:",K),H(K.message||"Failed to submit withdrawal request"),J(!1),U(!0),s()}finally{ee(!1)}},Te=()=>{U(!1),H(""),J(!1),g(""),A(""),v(""),N(""),_(""),n(""),O(null),R("")};return e.jsxs(e.Fragment,{children:[e.jsx(L,{open:t,title:"Withdraw Funds",onCancel:s,noConfirm:!0,children:e.jsxs(i,{sx:{display:"flex",flexDirection:"column",gap:3},children:[e.jsxs(w,{fullWidth:!0,sx:{mb:2},children:[e.jsx(k,{children:"Payment Method"}),e.jsxs(I,{value:h,label:"Payment Method",onChange:d=>A(d.target.value),children:[e.jsx(m,{value:"fiat",children:"Fiat"}),e.jsx(m,{value:"crypto",children:"Crypto"})]})]}),e.jsxs(w,{fullWidth:!0,sx:{mb:2},children:[e.jsx(k,{children:"Payment Account"}),e.jsxs(I,{value:T,label:"Payment Account",onChange:d=>{N(d.target.value),n("")},disabled:F||!h||D.length===0,error:!!P,children:[D.length===0&&h&&e.jsx(m,{value:"",disabled:!0,children:h==="fiat"?"Fiat payment method is unavailable for now":"Crypto payment method is unavailable for now"}),!h&&e.jsx(m,{value:"",disabled:!0,children:"Please select a payment method"}),D.map(d=>e.jsx(m,{value:d._id,children:d.accountNumber?`${d.accountNumber} (${d.bankName})`:`${d.walletAddress} (${d.network})`},d._id))]}),P&&e.jsx(a,{color:"error",variant:"body2",mt:1,children:P})]}),F&&e.jsx(i,{display:"flex",justifyContent:"center",mb:2,children:e.jsx(X,{size:24})}),z&&e.jsxs(a,{color:"error",variant:"body2",mb:2,children:["Error loading payment accounts: ",z.message]}),!F&&!z&&(M==null?void 0:M.length)===0&&e.jsx(a,{color:"error",variant:"body2",mb:2,children:"No payment accounts found. Please add an account."}),B&&e.jsxs(e.Fragment,{children:[e.jsxs(a,{variant:"body2",fontWeight:"bold",color:"text.primary",mb:1,children:["Withdrawal will be processed in ",j==="usd"?"USD (Fiat)":"USDT (Crypto)"]}),e.jsxs(Je,{children:[e.jsx(a,{variant:"subtitle1",fontWeight:"bold",color:"text.primary",mb:1,children:"Payment Details"}),B.accountNumber?e.jsxs(e.Fragment,{children:[e.jsxs(a,{variant:"body2",fontWeight:"bold",children:["Bank: ",e.jsx("span",{style:{fontWeight:"normal"},children:B.bankName||"N/A"})]}),e.jsxs(a,{variant:"body2",fontWeight:"bold",children:["Account Number: ",e.jsx("span",{style:{fontWeight:"normal"},children:B.accountNumber||"N/A"})]}),e.jsxs(a,{variant:"body2",fontWeight:"bold",children:["Account Name: ",e.jsx("span",{style:{fontWeight:"normal"},children:B.accountName||"N/A"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs(a,{variant:"body2",fontWeight:"bold",children:["Wallet Address: ",e.jsx("span",{style:{fontWeight:"normal"},children:B.walletAddress||"N/A"})]}),e.jsxs(a,{variant:"body2",fontWeight:"bold",children:["Network: ",e.jsx("span",{style:{fontWeight:"normal"},children:B.network||"N/A"})]})]})]})]}),e.jsx(W,{fullWidth:!0,label:`Withdrawal Amount (${j?j.toUpperCase():"Select a payment method"})`,type:"number",value:p,onChange:d=>{g(d.target.value),_("")},error:!!S,helperText:S,inputProps:{min:0,step:"0.01"},"aria-label":"Withdrawal amount",sx:{mb:2},disabled:!j}),r&&e.jsx(i,{display:"flex",justifyContent:"center",my:2,children:e.jsx(X,{size:24})}),o&&e.jsxs(a,{color:"error",variant:"body2",mb:2,children:["Error fetching broker fee: ",o.message]}),(y==null?void 0:y.brokerFee)&&e.jsxs(e.Fragment,{children:[e.jsxs(a,{variant:"body2",mb:1,children:[e.jsx("strong",{children:"Broker Fee Percentage:"})," ",y.brokerFee.fee,"% (Updated:"," ",new Date(y.brokerFee.updatedAt).toLocaleDateString(),")"]}),e.jsxs(a,{variant:"body2",mb:2,children:[e.jsx("strong",{children:"Broker Fee Amount:"})," $",le.toFixed(2)," (",y.brokerFee.fee,"% of $",G.toFixed(2),")"]})]}),e.jsxs(a,{variant:"caption",color:"text.secondary",mb:2,children:["Available Balance: $",((l==null?void 0:l.accountBalance)||0).toFixed(2)]}),e.jsxs(i,{mb:2,children:[e.jsx(a,{variant:"body2",mb:1,children:"Upload Broker Fee Proof (PNG)"}),e.jsxs(He,{...me(),children:[e.jsx("input",{...xe(),"aria-label":"Upload broker fee proof"}),be?e.jsx(a,{children:"Drop the PNG file here..."}):f?e.jsx(a,{children:f.name}):e.jsx(a,{children:"Drag & drop a PNG file here, or click to select"})]}),C&&e.jsx(a,{color:"error",variant:"body2",mt:1,children:C})]}),e.jsx(qe,{variant:"contained",color:"primary",onClick:ve,disabled:!!S||!p||!!P||!T||!j||!f||!!C||Z||F||r,fullWidth:!0,children:Z?e.jsx(X,{size:24}):"Submit Withdrawal"})]})}),e.jsx(Ve,{isOpen:re,onClose:Te,message:ne,isSuccess:c})]})},Qe=b(Q)(({theme:t})=>({padding:t.spacing(3),marginBottom:t.spacing(2)})),Ze=b(i)(({theme:t})=>({display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:t.spacing(1.5),padding:t.spacing(1),borderRadius:"8px",backgroundColor:t.palette.mode==="light"?t.palette.grey[100]:t.palette.grey[800],cursor:"pointer","&:hover":{backgroundColor:t.palette.mode==="light"?t.palette.grey[200]:t.palette.grey[700]}})),pe=b(se)(({theme:t})=>({marginTop:t.spacing(2),marginRight:t.spacing(1),textTransform:"none"})),et=b(i)(({theme:t})=>({display:"flex",justifyContent:"space-between",padding:t.spacing(2),borderRadius:"8px",backgroundColor:t.palette.mode==="light"?t.palette.grey[50]:t.palette.grey[900],marginBottom:t.spacing(3)})),tt=({user:t})=>{const{data:s,loading:l,error:r,callApi:o}=q(),{data:y,loading:x,error:p,callApi:g}=q(),{data:h,loading:A,error:j,callApi:v}=q(),{callApi:T}=q(),[N,S]=u.useState(null),[_,P]=u.useState(!1),[n,f]=u.useState(!1);u.useEffect(()=>{t!=null&&t._id&&o({url:`${Y.TRANSACTIONS}?userId=${t._id}`,method:"GET"})},[o,t==null?void 0:t._id]);const O=u.useCallback(()=>{g({url:"https://api.coingecko.com/api/v3/simple/price?ids=bitcoin,ethereum,tether&vs_currencies=usd",method:"GET"})},[g]);u.useEffect(()=>{n&&v({url:Y.BROKER_FEE,method:"GET"})},[n,v]);const C=u.useCallback(()=>{var M,F,z;if(!(s!=null&&s.transactions)||!y||!t)return{fiat:0,btc:0,eth:0,usdt:0,totalUsd:0};const c={fiat:0,btc:0,eth:0,usdt:0,totalUsd:0},J={btc:((M=y.bitcoin)==null?void 0:M.usd)||0,eth:((F=y.ethereum)==null?void 0:F.usd)||0,usdt:((z=y.tether)==null?void 0:z.usd)||0};return s.transactions.filter(E=>E.userId===t._id).forEach(E=>{E.currencyType==="fiat"?(c.fiat+=E.amount,c.totalUsd+=E.amount):E.currencyType==="crypto"&&E.cryptoCurrency&&(c[E.cryptoCurrency]+=E.amount,c.totalUsd+=E.amount*J[E.cryptoCurrency])}),c},[s,y,t]),R=c=>{S(c)},Z=()=>{O(),P(!0)},ee=()=>{P(!1)},ne=()=>{S(null)},H=()=>{f(!0)},re=()=>{f(!1)},U=t&&(s!=null&&s.transactions)?Array.from(new Map(s.transactions.map(c=>[c.transactionId,c])).values()).filter(c=>c.userId===t._id):[];return e.jsxs(Qe,{children:[t?e.jsxs(et,{children:[e.jsxs(i,{textAlign:"center",children:[e.jsx(a,{variant:"subtitle2",color:"text.secondary",children:"Account Balance"}),e.jsxs(a,{variant:"h6",fontWeight:600,children:["$",(t.accountBalance||0).toFixed(2)]})]}),e.jsxs(i,{textAlign:"center",children:[e.jsx(a,{variant:"subtitle2",color:"text.secondary",children:"Total Investment"}),e.jsxs(a,{variant:"h6",fontWeight:600,children:["$",(t.totalInvestment||0).toFixed(2)]})]}),e.jsxs(i,{textAlign:"center",children:[e.jsx(a,{variant:"subtitle2",color:"text.secondary",children:"Total ROI"}),e.jsxs(a,{variant:"h6",fontWeight:600,children:["$",(t.totalROI||0).toFixed(2)]})]})]}):e.jsx(a,{variant:"body2",color:"error",mb:3,children:"User data not available."}),e.jsx(a,{variant:"h6",fontWeight:600,mb:2,children:"Transactions"}),l&&e.jsx(i,{display:"flex",justifyContent:"center",my:2,children:e.jsx(X,{size:24})}),r&&e.jsxs(a,{color:"error",variant:"body2",mb:2,children:["Error: ",r.message]}),!l&&!r&&U.length===0&&e.jsx(a,{variant:"body2",color:"text.secondary",children:"No transactions found for this user."}),!l&&!r&&U.length>0&&e.jsx(i,{children:U.map(c=>e.jsxs(Ze,{onClick:()=>R(c),children:[e.jsxs(i,{children:[e.jsx(a,{variant:"subtitle1",fontWeight:600,children:c.companyName}),e.jsx(a,{variant:"caption",color:"text.disabled",children:new Date(c.createdAt).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})})]}),e.jsxs(i,{textAlign:"right",children:[e.jsxs(a,{variant:"body2",fontWeight:500,children:[c.amount.toFixed(2)," ",c.currencyType==="crypto"&&c.cryptoCurrency?c.cryptoCurrency.toUpperCase():c.currencyType.toUpperCase()]}),e.jsx(Ie,{status:c.status,children:c.status.charAt(0).toUpperCase()+c.status.slice(1)})]})]},c.transactionId))}),t&&e.jsxs(i,{display:"flex",children:[e.jsx(pe,{variant:"contained",color:"primary",onClick:Z,children:"View Total Investment"}),e.jsx(pe,{variant:"contained",color:"secondary",onClick:H,children:"Withdraw Funds"})]}),e.jsx(Ge,{selectedTransaction:N,onClose:ne}),e.jsx(Ke,{isOpen:_,onClose:ee,exchangeLoading:x,exchangeError:p,exchangeData:y,calculateTotals:C}),e.jsx(Xe,{isOpen:n,onClose:re,user:t,brokerFeeLoading:A,brokerFeeError:j,brokerFeeData:h,callApi:T})]})},at={isEditModalOpen:!1,isDeleteModalOpen:!1,paymentType:"fiat",paymentCurrency:"",bankName:"",accountNumber:"",accountName:"",cryptoAddress:"",network:"",paymentError:"",deletingPaymentDetailId:null},nt=(t,s)=>{switch(s.type){case"SET_EDIT_MODAL_OPEN":return{...t,isEditModalOpen:s.payload};case"SET_DELETE_MODAL_OPEN":return{...t,isDeleteModalOpen:s.payload};case"SET_PAYMENT_TYPE":return{...t,paymentType:s.payload};case"SET_PAYMENT_CURRENCY":return{...t,paymentCurrency:s.payload};case"SET_BANK_NAME":return{...t,bankName:s.payload};case"SET_ACCOUNT_NUMBER":return{...t,accountNumber:s.payload};case"SET_ACCOUNT_NAME":return{...t,accountName:s.payload};case"SET_CRYPTO_ADDRESS":return{...t,cryptoAddress:s.payload};case"SET_NETWORK":return{...t,network:s.payload};case"SET_PAYMENT_ERROR":return{...t,paymentError:s.payload};case"SET_DELETING_PAYMENT_DETAIL_ID":return{...t,deletingPaymentDetailId:s.payload};case"RESET_EDIT_FORM":return{...t,paymentType:"fiat",paymentCurrency:"",bankName:"",accountNumber:"",accountName:"",cryptoAddress:"",network:"",paymentError:""};default:return t}},rt=b(ye)(({theme:t})=>({width:48,height:48,fontSize:24,fontWeight:700,backgroundColor:t.palette.grey[200],color:t.palette.text.primary})),V=b(i)(()=>({display:"flex",alignItems:"center",marginTop:12})),ot={usd:"$",cad:"C$",eur:"€",gbp:"£",btc:"₿",eth:"Ξ",usdt:"₮"},st=({paymentDetail:t,userId:s})=>{const l=Ne(),[r,o]=u.useReducer(nt,at),{callApi:y,loading:x,error:p}=q(),g=!t||!t._id||!t.type||!t.currency,h=()=>{o({type:"RESET_EDIT_FORM"}),o({type:"SET_EDIT_MODAL_OPEN",payload:!0})},A=()=>{t&&(o({type:"SET_PAYMENT_TYPE",payload:t.type}),o({type:"SET_PAYMENT_CURRENCY",payload:t.currency}),t.type==="fiat"&&t.accountDetails?(o({type:"SET_BANK_NAME",payload:t.accountDetails.bankName||""}),o({type:"SET_ACCOUNT_NUMBER",payload:t.accountDetails.accountNumber||""}),o({type:"SET_ACCOUNT_NAME",payload:t.accountDetails.accountName||""})):t.type==="crypto"&&t.accountDetails&&(o({type:"SET_CRYPTO_ADDRESS",payload:t.accountDetails.address||""}),o({type:"SET_NETWORK",payload:t.accountDetails.network||""})),o({type:"SET_EDIT_MODAL_OPEN",payload:!0}))},j=()=>{o({type:"SET_EDIT_MODAL_OPEN",payload:!1}),o({type:"RESET_EDIT_FORM"})},v=()=>{t&&(o({type:"SET_DELETING_PAYMENT_DETAIL_ID",payload:t._id}),o({type:"SET_DELETE_MODAL_OPEN",payload:!0}))},T=()=>{o({type:"SET_DELETE_MODAL_OPEN",payload:!1}),o({type:"SET_DELETING_PAYMENT_DETAIL_ID",payload:null})},N=()=>{if(!r.paymentCurrency)return o({type:"SET_PAYMENT_ERROR",payload:"Please select a currency"}),!1;if(!r.paymentType)return o({type:"SET_PAYMENT_ERROR",payload:"Please select a payment type"}),!1;if(r.paymentType==="fiat"){if(!r.bankName||!r.accountNumber||!r.accountName)return o({type:"SET_PAYMENT_ERROR",payload:"Please fill in all bank details"}),!1}else if(r.paymentType==="crypto"&&!r.cryptoAddress)return o({type:"SET_PAYMENT_ERROR",payload:"Please provide a crypto address"}),!1;return o({type:"SET_PAYMENT_ERROR",payload:""}),!0},S=async()=>{if(x||!N())return;const n={userId:s,type:r.paymentType,currency:r.paymentCurrency,accountDetails:r.paymentType==="fiat"?{bankName:r.bankName,accountNumber:r.accountNumber,accountName:r.accountName,address:""}:{address:r.cryptoAddress,network:r.network===""?void 0:r.network}};try{const f=g?Y.PAYMENT_DETAILS:`${Y.PAYMENT_DETAILS}/update/${t._id}`,C=await y({url:f,method:g?"POST":"PUT",body:n});C.success&&C.paymentDetail?(l(Se(C.paymentDetail)),j()):o({type:"SET_PAYMENT_ERROR",payload:C.message||"Failed to save payment details"})}catch{const O=(p==null?void 0:p.message)||"Failed to save payment details";o({type:"SET_PAYMENT_ERROR",payload:O})}},_=async()=>{if(r.deletingPaymentDetailId)try{const n=await y({url:`${Y.PAYMENT_DETAILS}/delete/${r.deletingPaymentDetailId}`,method:"DELETE",body:{userId:s}});n.success?(l({type:"user/deletePaymentDetail",payload:r.deletingPaymentDetailId}),T()):o({type:"SET_PAYMENT_ERROR",payload:n.message||"Failed to delete payment detail"})}catch{const f=(p==null?void 0:p.message)||"Failed to delete payment detail";o({type:"SET_PAYMENT_ERROR",payload:f})}};if(g)return e.jsxs(Q,{sx:{padding:3,mb:3,textAlign:"center"},children:[e.jsx(a,{variant:"h6",color:"text.primary",gutterBottom:!0,children:"No Payment Account Added"}),e.jsx(a,{variant:"body2",color:"text.secondary",mb:2,children:"You have not yet added a payment account. Add one to start receiving payments."}),e.jsx(se,{variant:"contained",color:"primary",onClick:h,sx:{textTransform:"none"},children:"Add Payment Account"}),e.jsx(L,{open:r.isEditModalOpen,title:"Add Payment Details",onCancel:j,onConfirm:S,children:e.jsxs(i,{sx:{display:"flex",flexDirection:"column",gap:5},children:[e.jsxs(w,{fullWidth:!0,children:[e.jsx(k,{id:"payment-type-label",children:"Payment Type"}),e.jsxs(I,{labelId:"payment-type-label",value:r.paymentType,label:"Payment Type",onChange:n=>o({type:"SET_PAYMENT_TYPE",payload:n.target.value}),"aria-label":"Select payment type",children:[e.jsx(m,{value:"fiat",children:"Fiat"}),e.jsx(m,{value:"crypto",children:"Crypto"})]})]}),e.jsxs(w,{fullWidth:!0,children:[e.jsx(k,{id:"currency-label",children:"Currency"}),e.jsx(I,{labelId:"currency-label",value:r.paymentCurrency,label:"Currency",onChange:n=>o({type:"SET_PAYMENT_CURRENCY",payload:n.target.value}),"aria-label":"Select currency",children:r.paymentType==="fiat"?["usd","cad","eur","gbp"].map(n=>e.jsx(m,{value:n,children:n.toUpperCase()},n)):["btc","eth","usdt"].map(n=>e.jsx(m,{value:n,children:n.toUpperCase()},n))})]}),r.paymentType==="fiat"?e.jsxs(e.Fragment,{children:[e.jsx(W,{fullWidth:!0,label:"Bank Name",value:r.bankName,onChange:n=>o({type:"SET_BANK_NAME",payload:n.target.value}),"aria-label":"Bank name"}),e.jsx(W,{fullWidth:!0,label:"Account Number",value:r.accountNumber,onChange:n=>o({type:"SET_ACCOUNT_NUMBER",payload:n.target.value}),"aria-label":"Account number"}),e.jsx(W,{fullWidth:!0,label:"Account Name",value:r.accountName,onChange:n=>o({type:"SET_ACCOUNT_NAME",payload:n.target.value}),"aria-label":"Account name"})]}):e.jsxs(e.Fragment,{children:[e.jsx(W,{fullWidth:!0,label:"Crypto Address",value:r.cryptoAddress,onChange:n=>o({type:"SET_CRYPTO_ADDRESS",payload:n.target.value}),"aria-label":"Crypto address"}),e.jsxs(w,{fullWidth:!0,children:[e.jsx(k,{id:"network-label",children:"Network (Optional)"}),e.jsxs(I,{labelId:"network-label",value:r.network,label:"Network (Optional)",onChange:n=>o({type:"SET_NETWORK",payload:n.target.value}),"aria-label":"Select network",children:[e.jsx(m,{value:"",children:"None"}),["erc20","trc20","bep20","polygon","solana"].map(n=>e.jsx(m,{value:n,children:n.toUpperCase()},n))]})]})]}),(r.paymentError||p)&&e.jsx(a,{variant:"caption",color:"error",children:r.paymentError||(p==null?void 0:p.message)}),x&&e.jsx(a,{variant:"caption",color:"text.secondary",children:"Submitting..."})]})})]});const P=ot[t.currency]||"?";return e.jsxs(e.Fragment,{children:[e.jsxs(Q,{sx:{padding:2,mb:3},children:[e.jsxs(i,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsxs(i,{display:"flex",alignItems:"center",children:[e.jsx(rt,{children:P}),e.jsxs(i,{ml:1,children:[e.jsxs(a,{variant:"subtitle1",fontWeight:600,lineHeight:1.2,children:[t.type.toUpperCase()," Payment"]}),e.jsx(a,{variant:"caption",color:"text.disabled",fontWeight:500,children:t.currency.toUpperCase()})]})]}),e.jsxs(i,{display:"flex",gap:1,children:[e.jsx(ce,{onClick:A,"aria-label":"Edit payment detail",sx:{bgcolor:"grey.100","&:hover":{bgcolor:"grey.200"},p:.5},children:e.jsx(Ue,{size:16,style:{color:"grey.700"}})}),e.jsx(ce,{onClick:v,"aria-label":"Delete payment detail",sx:{bgcolor:"grey.100","&:hover":{bgcolor:"grey.200"},p:.5},children:e.jsx(ue,{size:16,style:{color:"grey.700"}})})]})]}),e.jsx(i,{mt:3,children:t.type==="fiat"?e.jsxs(e.Fragment,{children:[e.jsxs(V,{children:[e.jsx(a,{variant:"body2",color:"text.secondary",minWidth:120,children:"Bank Name:"}),e.jsx(a,{variant:"body2",fontWeight:500,children:t.accountDetails.bankName||"N/A"})]}),e.jsxs(V,{children:[e.jsx(a,{variant:"body2",color:"text.secondary",minWidth:120,children:"Account Name:"}),e.jsx(a,{variant:"body2",fontWeight:500,children:t.accountDetails.accountName||"N/A"})]}),e.jsxs(V,{children:[e.jsx(a,{variant:"body2",color:"text.secondary",minWidth:120,children:"Account Number:"}),e.jsx(a,{variant:"body2",fontWeight:500,children:t.accountDetails.accountNumber||"N/A"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs(V,{children:[e.jsx(a,{variant:"body2",color:"text.secondary",minWidth:120,children:"Address:"}),e.jsxs(a,{variant:"body2",fontWeight:500,children:[t.accountDetails.address||"N/A",t.accountDetails.address||"N/A"]})]}),t.accountDetails.network&&e.jsxs(V,{children:[e.jsx(a,{variant:"body2",color:"text.secondary",minWidth:120,children:"Network:"}),e.jsx(a,{variant:"body2",fontWeight:500,children:t.accountDetails.network.toUpperCase()})]})]})})]}),e.jsx(L,{open:r.isEditModalOpen,title:"Edit Payment Details",onCancel:j,onConfirm:S,children:e.jsxs(i,{sx:{display:"flex",flexDirection:"column",gap:5},children:[e.jsxs(w,{fullWidth:!0,children:[e.jsx(k,{id:"payment-type-label",children:"Payment Type"}),e.jsxs(I,{labelId:"payment-type-label",value:r.paymentType,label:"Payment Type",onChange:n=>o({type:"SET_PAYMENT_TYPE",payload:n.target.value}),"aria-label":"Select payment type",children:[e.jsx(m,{value:"fiat",children:"Fiat"}),e.jsx(m,{value:"crypto",children:"Crypto"})]})]}),e.jsxs(w,{fullWidth:!0,children:[e.jsx(k,{id:"currency-label",children:"Currency"}),e.jsx(I,{labelId:"currency-label",value:r.paymentCurrency,label:"Currency",onChange:n=>o({type:"SET_PAYMENT_CURRENCY",payload:n.target.value}),"aria-label":"Select currency",children:r.paymentType==="fiat"?["usd","cad","eur","gbp"].map(n=>e.jsx(m,{value:n,children:n.toUpperCase()},n)):["btc","eth","usdt"].map(n=>e.jsx(m,{value:n,children:n.toUpperCase()},n))})]}),r.paymentType==="fiat"?e.jsxs(e.Fragment,{children:[e.jsx(W,{fullWidth:!0,label:"Bank Name",value:r.bankName,onChange:n=>o({type:"SET_BANK_NAME",payload:n.target.value}),"aria-label":"Bank name"}),e.jsx(W,{fullWidth:!0,label:"Account Number",value:r.accountNumber,onChange:n=>o({type:"SET_ACCOUNT_NUMBER",payload:n.target.value}),"aria-label":"Account number"}),e.jsx(W,{fullWidth:!0,label:"Account Name",value:r.accountName,onChange:n=>o({type:"SET_ACCOUNT_NAME",payload:n.target.value}),"aria-label":"Account name"})]}):e.jsxs(e.Fragment,{children:[e.jsx(W,{fullWidth:!0,label:"Crypto Address",value:r.cryptoAddress,onChange:n=>o({type:"SET_CRYPTO_ADDRESS",payload:n.target.value}),"aria-label":"Crypto address"}),e.jsxs(w,{fullWidth:!0,children:[e.jsx(k,{id:"network-label",children:"Network (Optional)"}),e.jsxs(I,{labelId:"network-label",value:r.network,label:"Network (Optional)",onChange:n=>o({type:"SET_NETWORK",payload:n.target.value}),"aria-label":"Select network",children:[e.jsx(m,{value:"",children:"None"}),["erc20","trc20","bep20","polygon","solana"].map(n=>e.jsx(m,{value:n,children:n.toUpperCase()},n))]})]})]}),(r.paymentError||p)&&e.jsx(a,{variant:"caption",color:"error",children:r.paymentError||(p==null?void 0:p.message)}),x&&e.jsx(a,{variant:"caption",color:"text.secondary",children:"Submitting..."})]})}),e.jsx(L,{open:r.isDeleteModalOpen,title:"Confirm Delete",onCancel:T,onConfirm:_,children:e.jsxs(i,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx(a,{variant:"body1",color:"text.primary",children:"Are you sure you want to delete this payment detail? This action cannot be undone."}),r.paymentError&&e.jsx(a,{variant:"caption",color:"error",children:r.paymentError})]})})]})},lt=({anchorEl:t,handleMoreClose:s})=>e.jsxs(ke,{anchorEl:t,open:!!t,onClose:s,children:[e.jsxs(m,{onClick:s,sx:{"&:hover":{color:"primary.main"}},children:[e.jsx(Fe,{size:14,style:{marginRight:8}}),e.jsx(a,{fontWeight:500,children:"Edit"})]}),e.jsxs(m,{onClick:s,sx:{"&:hover":{color:"primary.main"}},children:[e.jsx(ue,{size:14,style:{marginRight:8}}),e.jsx(a,{fontWeight:500,children:"Remove"})]})]}),he=()=>{const t=De();return e.jsxs(i,{p:4,height:"100vh",display:"flex",alignItems:"center",flexDirection:"column",justifyContent:"center",children:[e.jsx(i,{maxWidth:350,children:e.jsx("img",{src:"/static/illustration/error-page.svg",width:"100%",alt:"Not logged In"})}),e.jsx(a,{variant:"h2",fontWeight:700,color:"primary.main",mt:3,children:"Ooops... You are not logged in"}),e.jsx(a,{color:"text.disabled",fontWeight:500,children:"The page you requested could not be found."}),e.jsx(_e,{to:"/authentication/sign-in",style:{display:"block",marginTop:"1.5rem",fontWeight:600,textDecoration:"underline",color:t.palette.primary.main},children:"Go to Login Page"})]})},it=b(Q)(({theme:t})=>({padding:t.spacing(3),[t.breakpoints.down("sm")]:{padding:t.spacing(2)}})),$=b(i)(()=>({display:"flex",alignItems:"center",marginTop:12})),dt=({user:t})=>{var p,g,h,A;const[s,l]=u.useState(null),r=()=>l(null),o=t!=null&&t.dateJoined?new Date(t.dateJoined).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):"User has not updated status",y=(p=t==null?void 0:t.address)!=null&&p.street&&((g=t==null?void 0:t.address)!=null&&g.city)&&((h=t==null?void 0:t.address)!=null&&h.state)&&((A=t==null?void 0:t.address)!=null&&A.country)?`${t.address.street}, ${t.address.city}, ${t.address.state}, ${t.address.country}`:"User has not updated status";if(!t)return e.jsx(he,{});const x=!t.paymentDetails||t.paymentDetails.length===0;return e.jsxs(ae,{container:!0,spacing:3,children:[e.jsx(ae,{item:!0,md:5,xs:12,children:e.jsxs(it,{children:[e.jsx(a,{variant:"h6",fontWeight:600,children:"Profile"}),e.jsx(Be,{sx:{my:2}}),e.jsxs(i,{children:[e.jsxs($,{children:[e.jsx(a,{variant:"body2",color:"text.secondary",minWidth:120,children:"Full Name:"}),e.jsx(a,{variant:"body2",fontWeight:500,children:t.firstName&&t.lastName?`${t.firstName} ${t.lastName}`:"User has not updated status"})]}),e.jsxs($,{children:[e.jsx(a,{variant:"body2",color:"text.secondary",minWidth:120,children:"Email:"}),e.jsx(a,{variant:"body2",fontWeight:500,children:t.email||"User has not updated status"})]}),e.jsxs($,{children:[e.jsx(a,{variant:"body2",color:"text.secondary",minWidth:120,children:"Phone:"}),e.jsx(a,{variant:"body2",fontWeight:500,children:t.phone||"User has not updated status"})]}),e.jsxs($,{children:[e.jsx(a,{variant:"body2",color:"text.secondary",minWidth:120,children:"Gender:"}),e.jsx(a,{variant:"body2",fontWeight:500,children:t.gender||"User has not updated status"})]}),e.jsxs($,{children:[e.jsx(a,{variant:"body2",color:"text.secondary",minWidth:120,children:"Status:"}),e.jsx(a,{variant:"body2",fontWeight:500,children:t.status||"User has not updated status"})]}),e.jsxs($,{children:[e.jsx(a,{variant:"body2",color:"text.secondary",minWidth:120,children:"Date Joined:"}),e.jsx(a,{variant:"body2",fontWeight:500,children:o})]}),e.jsxs($,{children:[e.jsx(a,{variant:"body2",color:"text.secondary",minWidth:120,children:"Address:"}),e.jsx(a,{variant:"body2",fontWeight:500,children:y})]})]})]})}),e.jsxs(ae,{item:!0,md:7,xs:12,children:[e.jsx(a,{variant:"h6",fontWeight:600,mb:2,children:"Payment Accounts"}),x?e.jsx(a,{variant:"body1",color:"text.secondary",sx:{mt:2},children:"Payment account not added"}):t.paymentDetails.map((j,v)=>e.jsx(st,{paymentDetail:j,userId:t._id},j._id||`${t._id}-payment-${v}`)),e.jsx(lt,{anchorEl:s,handleMoreClose:r})]})]})},ct="/assets/profileBanner-4Alv7BVf.jpg",pt=b(Q)(()=>({position:"relative",borderTopLeftRadius:0,borderTopRightRadius:0})),yt=b(i)(()=>({top:-20,alignItems:"center",position:"relative",display:"flex"})),oe=b(We)(({theme:t})=>({fontSize:13,color:t.palette.text.primary})),ut=b(Re)(({theme:t})=>({[t.breakpoints.down(780)]:{width:"100%","& .MuiTabs-flexContainer":{justifyContent:"space-between"},marginBottom:20},[t.breakpoints.up("sm")]:{"& .MuiTabs-flexContainer":{minWidth:400,justifyContent:"space-between"}}})),te=b(Me)(()=>({padding:0})),Dt=()=>{document.title="User Profile";const[t,s]=u.useState("1"),l=$e(),r=(o,y)=>{s(y)};return l?e.jsx(i,{pt:2,pb:4,children:e.jsxs(we,{value:t,children:[e.jsxs(pt,{children:[e.jsx(i,{sx:{height:200,width:"100%",overflow:"hidden"},children:e.jsx("img",{src:ct,alt:"User Cover",height:"100%",width:"100%",style:{objectFit:"cover"}})}),e.jsxs(i,{display:"flex",flexWrap:"wrap",px:4,alignItems:"center",justifyContent:"space-between",children:[e.jsxs(yt,{children:[e.jsx(Le,{src:l==null?void 0:l.profilePicture,sx:{border:4,width:100,height:100,borderColor:"background.paper"}}),e.jsxs(i,{ml:3,mt:3,children:[e.jsxs(a,{variant:"h5",lineHeight:1.2,children:[l==null?void 0:l.firstName,"  ",l==null?void 0:l.lastName]}),e.jsx(a,{variant:"body2",color:"text.disabled",children:(l==null?void 0:l.role)==="user"?"Investor":"Company"})]})]}),e.jsxs(ut,{onChange:r,children:[e.jsx(oe,{label:"Profile",value:"1"}),e.jsx(oe,{label:"Investments",value:"2"}),e.jsx(oe,{label:"Account",value:"3"})]})]})]}),e.jsxs(i,{mt:3,children:[e.jsx(te,{value:"1",children:l?e.jsx(dt,{user:l}):e.jsx(a,{children:"No user data available"})}),e.jsx(te,{value:"2",children:e.jsx(tt,{user:l})}),e.jsx(te,{value:"3",children:e.jsx(ae,{item:!0,lg:4,sm:6,xs:12,children:e.jsx(Oe,{user:l})})}),e.jsx(te,{value:"4",children:e.jsx(a,{variant:"h6",children:"Gallery"})})]})]})}):e.jsx(he,{})};export{Dt as default};
